# Security NFR (Non-Functional Requirements)

## Обзор
Данный документ содержит измеримые требования безопасности для SecDev Course Project.

## Таблица NFR

| ID     | Название | Описание | Метрика/Порог | Проверка (чем/где) | Компонент | Приоритет |
|--------|----------|----------|---------------|--------------------|-----------|-----------|
| NFR-01 | Хранение паролей | Хэширование только Argon2id | t=3, m=256MB, p=1 | Конфиг + unit-тест | auth | High |
| NFR-02 | Ошибки в формате RFC7807 | Маскирование PII; correlation_id | 100% endpoint'ов | Контракт-тесты + e2e | api | Medium |
| NFR-03 | Порог p95 /login | p95 ≤ 300 ms при 50 RPS на stage | p95 ≤ 300 ms @ 50 RPS | Нагрузочный тест | auth | High |
| NFR-04 | Уязвимости зависимостей | High/Critical ≤ 7 дней до устранения | ≤ 7 дней | CI-отчёт SCA/SBOM | build | High |
| NFR-05 | Ротация секретов | Регламент и автоматизация ротации | Раз в 30 дней | Vault/KMS политика + журнал | platform | Medium |
| NFR-06 | Логирование безопасности | Все security события логируются | 100% security events | SIEM/лог-анализ | monitoring | High |
| NFR-07 | Rate Limiting | Защита от brute force атак | ≤ 5 попыток/мин на IP | API Gateway + мониторинг | api | High |
| NFR-08 | HTTPS/TLS | Все соединения только по TLS 1.3+ | TLS 1.3+ | SSL Labs тест + конфиг | infrastructure | High |
| NFR-09 | Время жизни токенов | JWT токены с ограниченным TTL | ≤ 15 минут access, ≤ 7 дней refresh | Конфиг + тесты | auth | Medium |
| NFR-10 | Мониторинг аномалий | Детекция подозрительной активности | ≤ 5 мин до алерта | ML-детекция + алерты | security | High |

## Детальное описание NFR

### NFR-01: Хранение паролей
- **Цель**: Защита паролей пользователей от компрометации
- **Метрика**: Использование Argon2id с параметрами t=3, m=256MB, p=1
- **Проверка**: Unit-тесты проверяют корректность хэширования
- **Компонент**: Модуль аутентификации

### NFR-02: Ошибки в формате RFC7807
- **Цель**: Стандартизация и безопасность обработки ошибок
- **Метрика**: 100% API endpoints возвращают ошибки в формате RFC7807
- **Проверка**: Контракт-тесты и e2e тесты
- **Компонент**: API Gateway

### NFR-03: Производительность логина
- **Цель**: Обеспечение приемлемой производительности аутентификации
- **Метрика**: p95 времени ответа ≤ 300ms при нагрузке 50 RPS
- **Проверка**: Нагрузочное тестирование на stage окружении
- **Компонент**: Auth Service

### NFR-04: Уязвимости зависимостей
- **Цель**: Минимизация рисков от уязвимостей в зависимостях
- **Метрика**: High/Critical уязвимости устраняются в течение 7 дней
- **Проверка**: CI/CD пайплайн с SCA сканированием
- **Компонент**: Build Pipeline

### NFR-05: Ротация секретов
- **Цель**: Регулярное обновление секретов для снижения рисков
- **Метрика**: Автоматическая ротация каждые 30 дней
- **Проверка**: Vault/KMS политики и журналы ротации
- **Компонент**: Secret Management

### NFR-06: Логирование безопасности
- **Цель**: Полная видимость security событий для расследований
- **Метрика**: 100% security событий логируются в SIEM
- **Проверка**: SIEM дашборды и алерты
- **Компонент**: Security Monitoring

### NFR-07: Rate Limiting
- **Цель**: Защита от brute force и DDoS атак
- **Метрика**: ≤ 5 попыток входа в минуту с одного IP
- **Проверка**: API Gateway метрики и мониторинг
- **Компонент**: API Gateway

### NFR-08: HTTPS/TLS
- **Цель**: Шифрование всех соединений
- **Метрика**: TLS 1.3+ для всех соединений
- **Проверка**: SSL Labs тестирование и конфигурация
- **Компонент**: Infrastructure

### NFR-09: Время жизни токенов
- **Цель**: Ограничение времени действия токенов
- **Метрика**: Access токены ≤ 15 мин, Refresh ≤ 7 дней
- **Проверка**: Конфигурация и unit-тесты
- **Компонент**: Auth Service

### NFR-10: Мониторинг аномалий
- **Цель**: Раннее обнаружение подозрительной активности
- **Метрика**: Алерты в течение 5 минут после аномалии
- **Проверка**: ML-детекция и система алертов
- **Компонент**: Security Operations
